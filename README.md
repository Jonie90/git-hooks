# git-hooks
Convenient git hooks

#Commit Script
When I write commit messages I typically forget to state the issue number and this totally sucks. When omitting the issue number my commits won't be related to the issue in Jira and it will be difficult to do code reviews of my code and also to go back to old code and do changes, as well as see the work progress or status of a current issue.
To solve this problem I wanted to write a script which, after every commit, asks me if I remebered to state the issue number. If I press no, the commit message should open in my standard editor and I would get a chance to update it. If I press yes, the commit is completed.

## MVP
As an MVP I decided to change the commit message, by adding a checklist of the things I need to think about when writing a commit message.

## Sources
I got a lot of help from here:

  * https://www.atlassian.com/git/tutorials/git-hooks/local-hooks
  * http://stackoverflow.com/questions/3417896/how-do-i-prompt-the-user-from-within-a-commit-msg-hook

##git_templates
In order to get my customized hooks in all my repositories I created a git_templates folder and changed the template directory to the adress of my template folder. I found out how to do that from this page:

  https://coderwall.com/p/wp4xdg/global-git-templates-yes-that-means-hooks

using this command:

  git config --global init.templatedir /path/to/templates

Everything located here will automatically be placed in the .git folder for every repo created with git init or git clone.

## Template for commit message

This change was made using a template file instead of a hook.
The template contains the following text:

   DID YOU REMEBER?

   * TW-XXX
   * No ending dot
   * Subject should contain WHY
   * Empty line between subject and body
   * Body is optional, should explain how, dependencies, resources and quirks.
   * English

This text could also have been implemented using the commit-msg or pre-commit hooks but this meant that we would lose the autogenerated text:

    # Please enter the commit message for your changes. Lines starting
    # with '#' will be ignored, and an empty message aborts the commit.
    # On branch master
    #
    # Initial commit
    #

Creating this piece of text in code was outside of the scope for this assignment.
The template solution worked better since it just prepends the original commit message with the template.

### git command for changing the commit template
  config --global commit.template ~/path/to/template/gitcommittemplate.txt

### To choose my commit template
  config --global commit.template ~/sites/git_templates/gitcommittemplate.txt

## commit-msg hook
At first I wrote a simpler hook where yes meant that the commit was aborted and I had to redo it and no meant that I wanted to go ahead with the commit.
But I wanted the possibility to change my current commit message before committing. I found out the solution in this stackoverflow post:
  http://stackoverflow.com/questions/3417896/how-do-i-prompt-the-user-from-within-a-commit-msg-hook

And this is my result:

    #!/bin/sh

    echo "Committing!"

    local_editor=`git config --get core.editor`

    if [ -z "${local_editor}" ]
    then
      local_editor=${EDITOR}
    fi

    if [ -z "$(grep ':.*[a-zA-Z]' $1)" ]
    then
      # Allows us to read user input below, assigns stdin to keyboard
      exec < /dev/tty

      while true; do
        read -p "[commit-msg hook] Did you remember the issue number 'TW-xxx'? (Y/n) " yn
        if [ "$yn" = "" ]; then
          yn='Y'
        fi
        case $yn in
            [Yy] )  exit;;
            [Nn] )  ${local_editor} $1
                    exit;;
            * ) echo "Please answer y or n for yes or no.";;
        esac
      done

      exec <&-
    fi

It took a while before I realised that in order to commit directly after making a change, without having to get the question about the issue number again and type in "n", I only had to exit at the end of the [Nn] case after opening the editor. There was no need for storing boolean values in ENV variables or a file and so on.

At first I tried to make the script stop running and committing the commit (ie exiting with value 0) by having a variable called first_commit or something similar and setting it initally to true and then to false or empty string when "n" was pressed and then check if this variable was true or not before prompting the user.


##Further Development
Expand the if statement and make it check if the commit message starts with "TW", if not, ask it it should, otherwise just commit directly.

